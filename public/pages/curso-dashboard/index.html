<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Dashboard del curso — SyPdN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400..800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/base.css">
  <style>
    .dashboard-header{display:flex;justify-content:space-between;gap:1rem;flex-wrap:wrap;align-items:center}
    .dashboard-subtitle{color:var(--muted);margin-top:.25rem}
    .filters{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:.75rem;margin-top:1rem}
    .filters .label{display:block;font-size:.85rem;color:var(--muted);margin-bottom:.35rem}
    .filters .select,.filters .input{width:100%}

    #kpiGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-top:.35rem}
    #chartsGrid{display:flex;flex-direction:column;gap:1rem;margin-top:1.25rem}
    .dashboard-subgrid{display:grid;gap:1rem}
    .dashboard-subgrid.two{grid-template-columns:repeat(auto-fit,minmax(320px,1fr))}
    .dashboard-subgrid.three{grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
    .stat-card.full{grid-column:1 / -1}

    .stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1rem;box-shadow:var(--shadow);position:relative;overflow:hidden}
    .stat-card h3{margin:0 0 .35rem 0;font-size:1rem}
    .stat-value{font-size:1.85rem;font-weight:700;letter-spacing:-0.02em}
    .stat-meta{display:flex;gap:.5rem;flex-wrap:wrap;color:var(--muted);font-size:.85rem;margin-top:.4rem}
    .stat-badge{padding:.2rem .6rem;border-radius:999px;background:color-mix(in oklab,var(--primary) 12%, var(--surface));color:color-mix(in oklab,var(--primary) 80%, var(--text));border:1px solid color-mix(in oklab,var(--primary) 35%, var(--border));font-size:.75rem}

    .donut{--value:0;--size:90px;--color:var(--primary);width:var(--size);height:var(--size);border-radius:50%;background:conic-gradient(var(--color) calc(var(--value) * 1%), color-mix(in oklab,var(--border) 70%, transparent) 0);display:grid;place-items:center;position:relative}
    .donut::after{content:"";width:calc(var(--size) - 22px);height:calc(var(--size) - 22px);border-radius:50%;background:var(--surface);border:1px solid var(--border);position:absolute}
    .donut span{font-weight:700;position:relative;z-index:1}

    .stacked{display:flex;gap:.3rem;margin-top:.6rem}
    .stacked span{height:8px;border-radius:999px;flex:1;background:color-mix(in oklab,var(--border) 60%, transparent)}

    .list{display:flex;flex-direction:column;gap:.5rem;margin-top:.75rem}
    .list-item{display:flex;justify-content:space-between;align-items:center;gap:.5rem;padding:.5rem .6rem;border-radius:12px;background:color-mix(in oklab,var(--surface) 85%, var(--bg));border:1px solid var(--border)}
    .list-item strong{font-weight:600}
    .list-item.alert{border-color:#ef4444;background:color-mix(in oklab,#ef4444 12%, var(--surface))}
    .chip{padding:.15rem .45rem;border-radius:999px;font-size:.75rem;background:color-mix(in oklab,var(--accent) 12%, var(--surface));color:color-mix(in oklab,var(--accent) 85%, var(--text));border:1px solid color-mix(in oklab,var(--accent) 35%, var(--border))}
    .chip.alert{background:color-mix(in oklab,#ef4444 12%, var(--surface));color:#ef4444;border-color:color-mix(in oklab,#ef4444 35%, var(--border))}

    .bars{display:flex;flex-direction:column;gap:.6rem;margin-top:.75rem}
    .bar{display:grid;grid-template-columns:minmax(70px,auto) 1fr minmax(48px,auto);gap:.6rem;align-items:center;font-size:.85rem}
    .bar-track{height:10px;border-radius:999px;background:color-mix(in oklab,var(--border) 70%, transparent);overflow:hidden}
    .bar-fill{height:100%;border-radius:999px;background:linear-gradient(90deg,color-mix(in oklab,var(--primary) 85%, white),color-mix(in oklab,var(--accent) 80%, white))}
    .bar-fill.warn{background:linear-gradient(90deg,#f97316,#facc15)}
    .bar-fill.danger{background:linear-gradient(90deg,#ef4444,#f97316)}
    .bar-fill.good{background:linear-gradient(90deg,#22c55e,#86efac)}
    .bar-fill.top{background:linear-gradient(90deg,#38bdf8,#0ea5e9)}

    .legend{display:flex;gap:.6rem;flex-wrap:wrap;font-size:.8rem;margin-top:.6rem;color:var(--muted)}
    .legend span{display:flex;align-items:center;gap:.35rem}
    .dot{width:9px;height:9px;border-radius:50%}

    .empty{color:var(--muted);font-size:.9rem;margin-top:.6rem}

    .sparkline{width:100%;height:auto;margin-top:.6rem}
    .sparkline-line{fill:none;stroke:#38bdf8;stroke-width:2.5}
    .sparkline-area{fill:url(#sparkGradient)}
    .sparkline-meta{display:flex;gap:.75rem;flex-wrap:wrap;font-size:.85rem;color:var(--muted);margin-top:.4rem}
    .sparkline-axis{display:flex;justify-content:space-between;font-size:.75rem;color:var(--muted);margin-top:.15rem}
    .history-chart{width:100%;height:auto;margin-top:.75rem;background:color-mix(in oklab,var(--surface) 80%, #ffffff2d);border-radius:16px}
    .history-grid{stroke:color-mix(in oklab,var(--border) 80%, transparent);stroke-dasharray:4 6}
    .history-axis{fill:var(--muted);font-size:12px}
    .history-axis--strong{fill:var(--text);font-weight:600}
    .history-point{stroke-width:2;fill:var(--surface)}
    .history-legend{display:flex;gap:.75rem;flex-wrap:wrap;font-size:.8rem;color:var(--muted);margin-top:.4rem}
    .history-legend .legend-line{width:18px;height:3px;border-radius:999px;display:inline-block}
    .history-controls{display:flex;gap:.75rem;flex-wrap:wrap;margin-top:.6rem}
    .history-controls label{display:flex;flex-direction:column;gap:.3rem;font-size:.8rem;color:var(--muted)}
    .history-table{margin-top:.75rem;overflow:auto;max-height:320px;border:1px solid var(--border);border-radius:12px}
    .history-table table{width:100%;border-collapse:collapse;font-size:.85rem}
    .history-table th,.history-table td{padding:.55rem .75rem;border-bottom:1px solid var(--border);text-align:left;white-space:nowrap}
    .history-table thead th{position:sticky;top:0;background:color-mix(in oklab, var(--surface) 90%, var(--bg));z-index:1}

    @media (max-width: 720px){
      .donut{--size:72px}
      .stat-value{font-size:1.45rem}
    }
  </style>
</head>
<body>
  <nav id="appMenu"></nav>

  <main class="container">
    <section class="card">
      <div class="dashboard-header">
        <div>
          <h1>Dashboard del curso</h1>
          <div class="dashboard-subtitle">Analíticas en vivo basadas en la información cargada en la base.</div>
        </div>
        <div id="syncStatus" class="stat-badge">Actualizando...</div>
      </div>

      <div class="filters">
        <div>
          <label class="label" for="termFilter">Cuatrimestre</label>
          <select id="termFilter" class="select">
            <option value="ALL">Todo el curso</option>
            <option value="1">1° cuatrimestre</option>
            <option value="2">2° cuatrimestre</option>
          </select>
        </div>
        <div>
          <label class="label" for="topicFilter">Tema</label>
          <select id="topicFilter" class="select"></select>
        </div>
        <div>
          <label class="label" for="groupFilter">Grupo</label>
          <select id="groupFilter" class="select"></select>
        </div>
        <div>
          <label class="label" for="riskFilter">Umbral de alerta</label>
          <select id="riskFilter" class="select">
            <option value="50">≤ 50% aprobación</option>
            <option value="60" selected>≤ 60% aprobación</option>
            <option value="70">≤ 70% aprobación</option>
          </select>
        </div>
      </div>
    </section>

    <section class="dashboard-grid" id="kpiGrid"></section>
    <section class="dashboard-grid large" id="chartsGrid"></section>
  </main>

  <script src="/assets/js/api.js"></script>
  <script src="/assets/js/theme.js"></script>
  <script src="/assets/js/course-context.js"></script>
  <script src="/assets/js/menu.js"></script>
  <script src="/pages/curso-dashboard/dashboard.js"></script>
</body>
</html>